<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        box-sizing: border-box;
        padding: 0;
        margin: 0;
      }
      body {
        background-color: black;
      }
      button {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 16px;
        font-weight: bold;
        padding: 10px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <button id="btn">Moves: 0</button>
    <script>
      let moves = 0;
      let button = document.getElementById("btn");
      button.addEventListener("click", () => {
        button.innerText = `Moves: ${++moves}`;
      });

      let canvas = document.getElementById("canvas");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      let ctx = canvas.getContext("2d");

      let items = `162,817,812
57,618,57
906,360,560
592,479,940
352,342,300
466,668,158
542,29,236
431,825,988
739,650,466
52,470,668
216,146,977
819,987,18
117,168,530
805,96,715
346,949,466
970,615,88
941,993,340
862,61,35
984,92,344
425,690,689`
        .split("\n")
        .map((txt) => {
          return {
            x: (Math.random() * canvas.height) / 2,
            y: (Math.random() * canvas.width) / 2,
            text: txt.split(",")[0],
          };
        });
      let selectedIdx = null;

      let mouse = { x: 0, y: 0 };
      document.addEventListener("mousemove", (evt) => {
        if (selectedIdx != null) {
          let changeX = evt.clientX - mouse.x;
          let changeY = evt.clientY - mouse.y;
          items[selectedIdx].x += changeX;
          items[selectedIdx].y += changeY;
        }
        mouse.x = evt.clientX;
        mouse.y = evt.clientY;
      });
      document.addEventListener("mousedown", (evt) => {
        selectItem();
      });
      document.addEventListener("mouseup", (evt) => {
        selectedIdx = null;
        console.log(items);
      });

      function selectItem() {
        for (let i = 0; i < items.length; i++) {
          let item = items[i];
          if (
            isBetween(item.x, item.x + 100, mouse.x) &&
            isBetween(item.y, item.y + 100, mouse.y)
          ) {
            selectedIdx = i;
            return;
          }
        }
      }

      function isBetween(start, end, val) {
        return val > start && val < end;
      }

      requestAnimationFrame(loop);

      function loop() {
        requestAnimationFrame(loop);

        ctx.fillStyle = "rgb(50, 50, 50)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "white";
        // ctx.fillRect(0, canvas.height * 0.25, canvas.width, 3);
        // ctx.fillRect(0, canvas.height * 0.5, canvas.width, 3);
        ctx.fillRect(0, canvas.height * 0.75, canvas.width, 3);

        for (let item of items) {
          ctx.fillStyle = "white";
          ctx.fillRect(item.x, item.y, 70, 70);
          ctx.fillStyle = "black";
          ctx.font = "32px monospace";
          ctx.fillText(item.text, item.x + 8, item.y + 50);
        }
      }
    </script>
  </body>
</html>
